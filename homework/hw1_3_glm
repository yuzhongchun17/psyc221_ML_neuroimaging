# Importing necessary libraries
import pandas as pd
import numpy as np
import statsmodels.api as sm
import matplotlib.pyplot as plt
import seaborn as sns

# Loading the dataset
df = pd.read_csv('homework/data_assignment_1.csv')

# Dependent variables: Defining the regions
regions_to_residualize = ['Frontal_Sup', 'Frontal_Inf', 'Cingulum_Ant', 'Cingulum_Post', 'Parietal_Sup', 'Parietal_Inf', 'Occipital_Sup', 'Occipital_Inf', 'Temporal_Sup', 'Temporal_Inf']
# Indepedent variable
iv = ['diagnosis']
# Covariates
covariates = ['age','sex']
# Interaction term
df['sex_diagnosis_interaction'] = df['sex'] * df['diagnosis']

# Adjust dependent variables for the covariates
residuals_df = df.copy()
for region in regions_to_residualize:
    model = sm.OLS(df[region], sm.add_constant(df[covariates])).fit()
    residuals_df[region] = model.resid

# Significance of diagnosis
results_1 = {}
for region in regions_to_residualize:
    model_1 = sm.OLS(residuals_df[region], sm.add_constant(residuals_df[iv])).fit()
    p_value_diagnosis = model_1.pvalues[iv]
    results_1[region] = p_value_diagnosis

# Significance of diagnosis-sex interaction
results_2 = {}
for region in regions_to_residualize:
    model_2 = sm.OLS(residuals_df[region], sm.add_constant(df['sex_diagnosis_interaction'])).fit()
    p_value_interaction = model_2.pvalues['sex_diagnosis_interaction']
    results_2[region] = p_value_interaction


print(results_1)
print(results_2)